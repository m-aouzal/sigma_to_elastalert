description: |
  Detects the creation of the "PSScriptPolicyTest" PowerShell script by an uncommon process. This file is usually generated by Microsoft Powershell to test against Applocker.
name: PSScriptPolicyTest Creation By Uncommon Process
index: "winlogbeat-*"
filter:
- query:
    query_string:
      query: file.path.keyword:*__psscriptpolicytest_* AND (NOT (process.executable.keyword:(*\:\\program\ files\\powershell\\7\-preview\\pwsh.exe OR *\:\\program\ files\\powershell\\7\\pwsh.exe OR *\:\\windows\\system32\\dsac.exe OR *\:\\windows\\system32\\sdiagnhost.exe OR *\:\\windows\\system32\\servermanager.exe OR *\:\\windows\\system32\\windowspowershell\\v1.0\\powershell_ise.exe OR *\:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe OR *\:\\windows\\system32\\wsmprovhost.exe OR *\:\\windows\\syswow64\\sdiagnhost.exe OR *\:\\windows\\syswow64\\windowspowershell\\v1.0\\powershell_ise.exe OR *\:\\windows\\syswow64\\windowspowershell\\v1.0\\powershell.exe)))
type: any
priority: 2
