description: |
  Detects usage of Windows Input Method Editor (IME) keyboard layout feature, which allows an attacker to load a DLL into the process after sending the WM_INPUTLANGCHANGEREQUEST message.
  Before doing this, the client needs to register the DLL in a special registry key that is assumed to implement this keyboard layout. This registry key should store a value named "Ime File" with a DLL path.
  IMEs are essential for languages that have more characters than can be represented on a standard keyboard, such as Chinese, Japanese, and Korean.
  
name: Uncommon Extension In Keyboard Layout IME File Registry Value
index: "winlogbeat-*"
filter:
- query:
    query_string:
      query: (registry.path.keyword:*\control\keyboard layouts* AND registry.path.keyword:*ime file*) AND (NOT winlog.event_data.Details.keyword:*.ime)
type: any
priority: 3
